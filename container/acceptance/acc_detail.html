<!--验收 -  详情页 - wwb-->
<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="import" href="./detail_tpl.html" id="acc_detail_tpl"/>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/themes.css" rel="stylesheet" />
		<link href="../../css/check.css"  rel="stylesheet"/>
		<link href="../../css/index_view.css" rel="stylesheet" />
		
	</head>

	<body>
		<div class="mui-content detailRow">
			<div class="detail-header-flex">
				<div class="am-action">
					<a class="mui-icon mui-icon-arrowleft"></a>
					<a class="theme_back_font">上一个</a>
				</div>
				<div>1/12</div>
				<div class="am-action">
					<a class="theme_next_font">下一个</a>
					<a class="mui-icon mui-icon-arrowright"></a>
				</div>
			</div>
			<form class="mui-input-group" id="detailContent" style="background:none;">
				<ul class="mui-table-view" style="margin-bottom:12px;">
					<li class="mui-table-view-cell mui-collapse">
						<a class="mui-navigate-right" href="#">产品信息</a>
						<div class="mui-collapse-content">
								<div class="mui-input-row">
									<label>通用名</label>
									<p class="detailRow_content">131312313131231313123131312313131231313123</p>
									<span class="detailRow_right">25</span>
								</div>
						</div>
					</li>
				</ul>
			</form>
			<div id="List"></div>
			<div id="addBtn">
				<button class="mui-btn mui-btn-block btn">+ 增加批号</button>
			</div>
			<button type="button" id="acceptance" class="mui-btn mui-btn-warning mui-btn-block" style='margin-bottom: 20px;' data-loading-text = "提交中" data-loading-icon-position="right">确认验收</button>
		</div>
		
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/template-web.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
		
		<script type="text/javascript">
			

			(function($) {
				
				$.init()
				mui(document.body).on('tap', '#acceptance', function(e) {
		            mui(this).button('loading');
		            setTimeout(function() {
		                mui(this).button('reset');
		                common.openwin('../Result/index',{ acceptance: true })
		            }.bind(this), 2000);
		        });

				// 模板加载
				$.ready(function(){
					//console.log("当前页面URL："+plus.webview.currentWebview().getURL());
					var data = {
						list: [{
							"id":"1",
							"type":"暗销盘",
							"deptName":"部门1",
							"createrUser":"王大雷",
							"pdPerson":"王磊",
							"supplier:Name": "静注人免疫球蛋白",
							"drugName": "西咪替丁",
							"producter": "北京汉典制药有限公司",
							"distributionNo": "AADKSF1OOSKDF2",
							"spec":"80mg/瓶",
							"date": "2018-08-08",
							"updateTime":'2018-08-10'
						}]
					};
					var utils = new Utils();
					utils.appendModule('#acc_detail_tpl');
					var html = template('detail_tpl', data);
					document.getElementById('detailContent').innerHTML = html;
				});
				/*
					 *2 点击添加按钮 增加选填项    开始
					 * 
					 * 拖拽后显示操作图标，点击操作图标删除元素
					 */
					
					var itemNum = 0;
					mui("#addBtn").on('tap', '.mui-btn', function() {
						var ParentDiv = document.createElement("div")
						ParentDiv.className = "mui-table-view-cell slide-main";
						ParentDiv.setAttribute('data-index', itemNum);
						ParentDiv.innerHTML = '<div class="mui-slider-handle">' +
							'<div class="mui-input-group">' +
							'<div class="mui-input-row">' +
							'<label>生产批号</label>' +
							'<input type="text" name="buycontent" class="mui-input-clear mui-input" placeholder="请输入" >' +
							'</div>' +
							'<div class="mui-input-row">' +
							'<label>数量</label>' +
							'<input type="text" name="buycontent" class="mui-input-clear mui-input" placeholder="请输入" >' +
							'</div>' +
							'</div>' +
							'</div>' +
							'<div class="mui-slider-right mui-disabled">' +
							'<a class="mui-btn mui-btn-red">删除</a>' +
							'</div>';
						document.getElementById("List").appendChild(ParentDiv);
						itemNum++;
						addSlideDelete(); //添加侧滑删除
					})
					function addSlideDelete() {
						mui('.slide-main').off('tap', '.mui-btn').on('tap', '.mui-btn', function(event) {
							var elem = this;
							var li = elem.parentNode.parentNode;
							mui.confirm('确认删除该条记录？', '操作提醒', btnArray, function(e) {
								if(e.index == 0) {
									setTimeout(function() {
										mui.swipeoutClose(li);
									}, 0);
									itemNum--;
									li.parentNode.removeChild(li);
									//if(orderList.length==orderListArray.length){
									var index = li.getAttribute('data-index');
									//获取该删除的子项的index
									orderList.splice(index, 1);
									orderListArray.splice(index, 1);
									console.log(JSON.stringify(orderList));
									console.log(orderListArray)
									//}
		
								} else {
									setTimeout(function() {
										mui.swipeoutClose(li);
									}, 0);
								}
							});
						});
						var btnArray = ['确认', '取消'];
					}
				
				$.plusReady(function(){
					var self = plus.webview.currentWebview();
					console.log(self,'self')
	//				var name = self.name;
	//				console.log(name,'name')
				})
			})(mui);
		
		</script>
	</body>

</html>