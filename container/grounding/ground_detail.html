<!--上架 -  详情页 - wwb-->
<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="import" href="./detail_tpl.html" id="ground_detail_tpl"/>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/themes.css" rel="stylesheet" />
		<link href="../../css/check.css"  rel="stylesheet"/>
		<link href="../../css/index_view.css" rel="stylesheet" />
		
	</head>

	<body>
		<div class="mui-content detailRow">
			<!--<div class="detail-header-flex">
				<div class="am-action">
					<a class="mui-icon mui-icon-arrowleft"></a>
					<a class="theme_back_font">上一个</a>
				</div>
				<div>1/12</div>
				<div class="am-action">
					<a class="theme_next_font">下一个</a>
					<a class="mui-icon mui-icon-arrowright"></a>
				</div>
			</div>-->
			<form class="mui-input-group" id="detailContent" style="background:none;">
				<ul class="mui-table-view" style="margin-bottom:12px;">
					<li class="mui-table-view-cell mui-collapse">
						<a class="mui-navigate-right" href="#">产品信息</a>
						<div class="mui-collapse-content">
							
						</div>
					</li>
				</ul>
			</form>
			
		</div>
		
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/template-web.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			

			(function($) {
				
				$.plusReady(function(){
					
					var self = plus.webview.currentWebview();
					var details = JSON.parse(self.details);//获得参数

					var data = {}, groundUrl = '/a/checkacceptdetail/finish';
					data.hasGround = details.hasGround;
					data.list = [];
					data.list.push(details);
					if(details.hasGround){
						var groundBtn = '<button type="button" id="ground" class="mui-btn mui-btn-warning mui-btn-block" style="margin-bottom: 20px;" data-loading-text = "提交中" data-loading-icon-position="right">确认上架</button>'
						document.querySelector('.detailRow').insertAdjacentHTML("beforeEnd",groundBtn);
					}
					var utils = new Utils();
					utils.appendModule('#ground_detail_tpl');
					
					
					
					var html = template('detail_tpl', data);
					document.getElementById('detailContent').innerHTML = html;
					
					
					
					// 上架
					if(details.hasGround){
						var ground = document.querySelector('#ground');
						ground.addEventListener('tap',function(e){
							var realNum = document.querySelector('.relNum').value;
							var realReceiveStore = document.querySelector('.realReceiveStore').value;
							if(realNum <= 0 ){
								return mui.toast('实际上架数量不能小于或等于0')
							}
							if(realNum > details.realNum){
								return mui.toast('实际数量不得大于指示数量');
							}
							document.activeElement.blur(); // 隐藏软键盘
							var btnArray = ['否', '是'];
							mui.confirm('是否确认上架？', '操作提示', btnArray, function(e) {
								if (e.index == 1) {
									var detailListVo = [],postData = {},submitData = {};
									postData.id = details.id;
									postData.realNum = realNum;
									postData.realReceiveStore = realReceiveStore;
									detailListVo.push(postData);
									submitData.detailListVo = detailListVo;
									submitData.distributeCode = details.distributecode;
									console.log(JSON.stringify(submitData));
									mui.ajaxRequest(groundUrl,{
				                		type: 'POST',
				                		data: submitData,
				                		contentType: "application/json",
				                		showWaiting: true,
				                		success: function(data){
				                			if(data.code === 200){
				                				mui.toast('上架成功');
				                			}else{
				                				mui.alert(data.msg)
				                			}
				                		},
				                		error: function(xhr,type,errorThrown){
											alert(xhr.responseText)
				                		}
				            		});
								}
							},'div')
						});
					}
				})
			})(mui);
		
		</script>
	</body>

</html>