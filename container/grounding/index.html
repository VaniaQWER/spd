<!--上架  - 列表页 - wwb-->
<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="import" href="../../tpl/ground_card.html " id="card_view"/>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/themes.css" rel="stylesheet" />
		<link href="../../css/index_view.css" rel="stylesheet" />
	</head>

	<body>
		<div class="mui-content">
		    <div class="mui-input-row mui-search search_head">
				<input type="search" class="mui-input-clear" placeholder="供应商名称">
			</div>
			<div id="slider" class="mui-slider themes_tab">
				<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<a class="mui-control-item themes_font_color_tab" href="#item1mobile">待上架</a>
					<a class="mui-control-item themes_font_color_tab" href="#item2mobile">已上架</a>
				</div>
				<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-6"></div>
				<div class="mui-slider-group">
					<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll" id='mui-table-view-tab1'>
								<div class="mui-loading">
									<div class="mui-spinner">
									</div>
								</div>
								<!-- template-->
							</div>
						</div>
					</div>
					<div id="item2mobile" class="mui-slider-item mui-control-content">
						<div id="scroll2" class="mui-scroll-wrapper">
							<div class="mui-scroll" id='mui-table-view-tab2'>
								<div class="mui-loading">
									<div class="mui-spinner">
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>

		</div>
		<script src="../../js/mui.js"></script>
		<script src="../../js/mui.pullToRefresh.js"></script>
		<script src="../../js/mui.pullToRefresh.material.js"></script>
		<script src="../../js/template-web.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/request.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			

			(function($,doc) {
				
				var deceleration = mui.os.ios?0.003:0.0009;
				$('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration:deceleration
				});
				
				var utils = new Utils();
				utils.appendModule('#card_view');
				
				$.plusReady(function(){
					var selected = undefined,hasChecked = false,url = undefined;
					currSelected();
					$.init({
		                pullRefresh: {
		                    container: selected, //下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
		                    down: {
		                        style: 'circle', //必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
		                        color: '#f2a11c',
		                        auto: true, //可选,默认false.首次加载自动上拉刷新一次
		                        callback: function () {
		                        	url = !hasChecked ? '/groundList': '/groundList2'
		                        	mui.ajaxRequest(url,{
			                        		type: 'GET',
			                        		success: function(data){
			                        			console.log(data,'data')
			                        			data.hasGrounding = hasChecked
			                        			return template(selected,data);
			                        		},
			                        		error: function(xhr,type,errorThrown){
												alert(xhr.responseText)
			                        		}
		                        		})
		                        	
		                        }
		                    },
		                    up: {
								contentrefresh : "正在加载...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
	      						contentnomore:'没有更多数据了',
								callback: function() {
									console.log('up')
									var self = this;
									console.log(self,'self')
//									self.endPullUpToRefresh();
								}
							}
		                }
		                
		            });
		            
					
					 /* 渲染模板   */
					
	            	function template(selected, data){
	                    utils.innerTplHtml('ground_list', selected, data, function() {
							$('#mui-table-view-tab1').pullRefresh().endPulldown();
						})
	            	}
	            	
	            	function currSelected(){
						var item1mobile = document.querySelector('#item1mobile');
						var item2mobile = document.querySelector('#item2mobile');
						if(item1mobile.className.indexOf('mui-active')>0){
							selected = '#mui-table-view-tab1';
							hasChecked = false;
						}else{
							selected = '#mui-table-view-tab2';
							hasChecked = true;
						}
	            	}
	            	
	            	var item2 = document.getElementById('item2mobile');
					document.getElementById('slider').addEventListener('slide', function(e) {
						currSelected();
						if (e.detail.slideNumber === 1) {
							if (item2.querySelector('.mui-loading')) {
								mui.ajaxRequest('/groundList2',{
	                        		type: 'GET',
	                        		success: function(data){
	                        			data.hasGrounding = hasChecked;
	                        			return template(selected,data);
	                        		},
	                        		error: function(xhr,type,errorThrown){
										alert(xhr.responseText)
	                        		}
	                        	})
							}
						}else{
							console.log('待验收')
						}
					});
					
					//tab页切的点击事件
					var sliderSegmentedControl = document.getElementById('sliderSegmentedControl');
					$('.mui-input-group').on('change', 'input', function() {
						if (this.checked) {
							sliderSegmentedControl.className = 'mui-slider-indicator mui-segmented-control mui-segmented-control-inverted mui-segmented-control-' + this.value;
							//force repaint
							sliderProgressBar.setAttribute('style', sliderProgressBar.getAttribute('style'));
						}
					});
	            	
	            	//绑定点击事件  - 进入详情页
						
					$('#slider').on('tap','.am-card',function(){
						let id = this.getAttribute('data-id');
						console.log(id,'id');
						common.openwin('ground_list',{ targetId: id }, {
							titleText: '药品信息'
						})
					})
				})
			})(mui,document);
		
		</script>
	</body>

</html>